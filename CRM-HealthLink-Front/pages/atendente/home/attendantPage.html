<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <title>Home do Atendente</title>
  <link rel="icon" href="/images/logo2.png" type="image/png">
  <link rel="stylesheet" href="attendatStyle.css">
  <link rel="stylesheet" href="/css/employeeStyle.css">
  <script src="/js/employee.js" defer></script>
  <script src="attendantFunctionAppointment.js" defer></script>
  <script src="attendantFunctionPatient.js" defer></script>
  <script src="attendantFunctionDoctor.js" defer></script>

</head>

<body>
  <header>
    <section class="top-header">
      <div class="interface">
        <div class="logotipo">
          <a href="#">
            <img src="/images/logo2.png" alt="Logo da Empresa" class="logo">
          </a>
        </div>

        <div class="welcome-message">
          <h1 id="welcome-message"></h1>
        </div>

        <div class="btn-back-button">
          <a href="#">
            <button id="back-button" class="back-button" onclick="singOut()"> <i class="bi bi-box-arrow-left"></i>
              Sair</button>
          </a>
        </div>
      </div>
    </section>

    <section class="bottom-header">
      <div class="interface">
        <nav>
          <ul>
            <li class="menu-drop"><a>Entidades <i class="bi bi-caret-down-fill"></i></a>
              <div class="drop">
                <a href="#pacientes">Paciente</a>
                <a href="#doutores">Médico</a>
              </div>
            </li>
            <li><a href="#consultas">Consulta</a></li>
          </ul>
        </nav>

      </div>
    </section>
  </header>

  <main>
    <section id="pacientes" class="content-section">
      <h2>Gerenciar Pacientes</h2>
      <section class="p-3">
        <div class="row">
          <div class="col-12">
            <button class="btn btn-primary newUser" data-bs-toggle="modal" data-bs-target="#userForm" type="submit"
              onclick="limparCampos()">
              <strong>Criar Paciente</strong><i class="bi bi-people"></i>
            </button>

            <button class="btn btn-primary searchUser" data-bs-toggle="modal" data-bs-target="#userSearch"
              onclick="limparPesquisar()">
              <strong>Pesquisar Paciente</strong><i class="bi bi-search"></i>
            </button>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <table class="table table-striped table-hover mt-3 text-center table-bordered">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nome</th>
                  <th>Data de Nascimento</th>
                  <th>CPF</th>
                  <th>E-Mail</th>
                  <th>Opções</th>
                </tr>
              </thead>

              <tbody>

              </tbody>
            </table>
          </div>
        </div>
      </section>
      <!-- Modal Form -->
      <div class="modal fade" id="userForm">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Preencha o Formulário</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <form id="criar-paciente-form" class="needs-validation" novalidate>
                <!-- <div class="card imgholder">
                      <label for="imgInput" class="upload">
                        <input type="file" id="imgInput" />
                        <i class="bi bi-plus-circle-dotted"></i>
                      </label>
                      <img
                        src="./image/Profile Icon.webp"
                        alt=""
                        width="200"
                        height="200"
                        class="img img-form"
                      />
                    </div> -->

                <div class="inputField" id="inputFieldForm">
                  <div class="mb-3">
                    <!-- Nome -->
                    <label for="criar-paciente-nome" class="form-label">Nome:</label>
                    <input type="text" id="criar-paciente-nome" class="form-control" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      O nome deve conter apenas letras e espaços e não pode ser vazio ou composto apenas de espaços.
                    </div>
                  </div>

                  <div class="mb-3">
                    <!-- Data de Nascimento -->
                    <label for="criar-paciente-data-nascimento" class="form-label">Data de Nascimento:</label>
                    <input type="date" id="criar-paciente-data-nascimento" class="form-control" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      A data de nascimento não pode estar em branco.
                    </div>
                  </div>

                  <div class="mb-3">
                    <!-- CPF -->
                    <label for="criar-paciente-cpf" class="form-label">CPF:</label>
                    <input type="text" id="criar-paciente-cpf" class="form-control" maxlength="14" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      O CPF deve conter 11 números.
                    </div>
                  </div>

                  <div class="mb-3">
                    <!-- EMAIL -->
                    <label for="criar-paciente-email" class="form-label">E-mail:</label>
                    <input type="email" id="criar-paciente-email" class="form-control" autocomplete="new-email"
                      required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">Por favor, insira um e-mail válido.</div>
                  </div>

                  <div class="mb-3">
                    <!-- Senha -->
                    <label for="criar-paciente-password" class="form-label">Senha:</label>
                    <input type="password" id="criar-paciente-password" class="form-control" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      A senha deve ter no mínimo 3 caracteres.
                    </div>
                  </div>
                </div>

                <div id="resultsCreate" class="resultsCreate"></div>
              </form>
            </div>
            <div class="modal-footer">
              <button id="newUserBtn" type="submit" form="criar-paciente-form" class="btn btn-primary mt-3">
                Criar Paciente
              </button>
            </div>
          </div>
        </div>
      </div>



      <!-- Update Modal-->
      <div class="modal fade" id="updateUserForm">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Atualizar Paciente</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <form id="update-patient-form" class="needs-validation" novalidate>
                <div class="inputField" id="inputFieldForm">

                  <!-- Campos não editáveis -->
                  <div class="mb-4">
                    <div class="mb-3">
                      <label for="update-patient-cpf" class="form-label">CPF (não editável):</label>
                      <input type="text" id="update-patient-cpf" class="form-control" maxlength="14" autocomplete="off"
                        placeholder="000.000.000-00" required />
                      <div class="valid-feedback">Tudo certo!</div>
                      <div class="invalid-feedback">
                        O CPF deve conter 11 números.
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="update-patient-email" class="form-label">E-mail (não editável):</label>
                      <input type="email" id="update-patient-email" class="form-control" autocomplete="off"
                        placeholder="exemplo@email.com" required />
                      <div class="valid-feedback">Tudo certo!</div>
                      <div class="invalid-feedback">Por favor, insira um e-mail válido.</div>
                    </div>
                  </div>

                  <!-- Campos editáveis -->
                  <div class="mb-3">
                    <label for="update-patient-name" class="form-label">Nome:</label>
                    <input type="text" id="update-patient-name" class="form-control" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      O nome deve conter apenas letras e espaços e não pode ser vazio ou composto apenas de espaços.
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="update-patient-birthdate" class="form-label">Data de Nascimento:</label>
                    <input type="date" id="update-patient-birthdate" class="form-control" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      A data de nascimento não pode estar em branco.
                    </div>
                  </div>

                  <div class="mb-3">
                    <label for="update-patient-password" class="form-label">Senha:</label>
                    <input type="password" id="update-patient-password" class="form-control" required />
                    <div class="valid-feedback">Tudo certo!</div>
                    <div class="invalid-feedback">
                      A senha deve ter no mínimo 3 caracteres.
                    </div>
                  </div>
                </div>

                <div id="resultsUpdate" class="resultsUpdate"></div>
                <!-- <div id="updateResults" class="resultsUpdate"></div> -->
              </form>
            </div>

            <div class="modal-footer">
              <button id="updateUserBtn" type="submit" form="update-patient-form" class="btn btn-primary mt-3">
                Atualizar Paciente
              </button>
            </div>
          </div>
        </div>
      </div>



      <!--Read Data Modal-->
      <div class="modal fade" id="readData">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Perfil</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <form action="#" id="readForm">
                <!-- <div class="card imgholder">
                          <img
                            src="./image/Profile Icon.webp"
                            alt=""
                            width="200"
                            height="200"
                            class="showImg img-read"
                          />
                        </div> -->

                <div class="inputField" id="inputFieldRead">
                  <div>
                    <label for="name">Nome:</label>
                    <input type="text" name="" id="showName" disabled />
                  </div>

                  <div>
                    <label for="sCPF">CPF:</label>
                    <input type="text" name="" id="showsCPF" disabled />
                  </div>

                  <div>
                    <label for="sDate">Data de Nascimento:</label>
                    <input type="date" name="" id="showsDate" disabled />
                  </div>

                  <div>
                    <label for="email">E-Mail:</label>
                    <input type="email" name="" id="showEmail" disabled />
                  </div>


                </div>
              </form>
            </div>
          </div>
        </div>
      </div>


      <!--Get Data Modal-->
      <div class="modal fade" id="userSearch" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="searchModalLabel">Pesquisar Paciente</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
              <form id="searchFormPatient">
                <div class="mb-3">
                  <label for="searchEmailPatient" class="form-label">E-mail do Paciente</label>
                  <input type="email" class="searchEmailPatient" id="searchEmailPatient"
                    placeholder="Digite o e-mail do Paciente" required />
                </div>
            </div>
            </form>
            <div class="text-center">
              <div id="resultsGet" class="mt-3"></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary searchConfirm">
                Pesquisar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Delete Confirmation Modal -->
      <div id="deleteModal" class="modal">
        <div class="modal-content">
          <h4>Confirma a exclusão deste item?</h4>
          <button id="confirmDelete" class="btn btn-danger">Sim</button>
          <button id="cancelDelete" class="btn btn-secondary">Não</button>
        </div>
        <div id="resultsDelete"></div>
      </div>
    </section>




    <section id="doutores" class="content-section" style="display: none;">
      <h2>Gerenciar Médicos</h2>
      <section class="p-3">
        <div class="row">
          <div class="col-12">

            <button class="btn btn-primary searchDoctor" data-bs-toggle="modal" data-bs-target="#doctorSearch">
              <strong>Pesquisar Médico</strong><i class="bi bi-search"></i>
            </button>

          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <table class="table table-striped table-hover mt-3 text-center table-bordered">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nome</th>
                  <th>Data de Nascimento</th>
                  <th>CPF</th>
                  <th>CRM</th>
                  <th>E-Mail</th>
                  <th>Especialidade</th>
                  <th>Opções</th>
                </tr>
              </thead>

              <tbody id="doctorTableBody">

              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!--Read Data Modal-->
      <div class="modal fade" id="doctorReadData">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Perfil</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <form action="#" id="doctorReadForm">
                <!-- <div class="card imgholder">
                          <img
                            src="./image/Profile Icon.webp"
                            alt=""
                            width="200"
                            height="200"
                            class="showImg img-read"
                          />
                        </div> -->

                <div class="inputField" id="doctorInputFieldRead">
                  <div>
                    <label for="doctorShowName">Nome:</label>
                    <input type="text" name="" id="doctorShowName" disabled />
                  </div>

                  <div>
                    <label for="doctorShowDate">Data de Nascimento:</label>
                    <input type="date" name="" id="doctorShowDate" disabled />
                  </div>

                  <div>
                    <label for="doctorShowCPF">CPF:</label>
                    <input type="text" name="" id="doctorShowCPF" disabled />
                  </div>

                  <div>
                    <label for="doctorShowCRM">CRM:</label>
                    <input type="text" name="" id="doctorShowCRM" disabled />
                  </div>

                  <div>
                    <label for="doctorShowEmail">E-Mail:</label>
                    <input type="email" name="" id="doctorShowEmail" disabled />
                  </div>

                  <div>
                    <label for="doctorShowSpecialty">Especialidade:</label>
                    <input type="text" name="" id="doctorShowSpecialty" disabled />
                  </div>

                </div>
              </form>
            </div>
          </div>
        </div>
      </div>


      <!--Get Data Modal-->
      <div class="modal fade" id="doctorSearch" tabindex="-1" aria-labelledby="doctorSearchLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="doctorSearchLabel">Pesquisar Médico</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
              <form id="searchFormDoctor">
                <div class="mb-3">
                  <label for="searchEmailDoctor" class="form-label">E-mail do Médico</label>
                  <input type="email" class="searchEmailDoctor" id="searchEmailDoctor"
                    placeholder="Digite o e-mail do Médico" required />
                </div>
              </form>

              <div class="text-center">
                <div id="resultsGetDoctor" class="mt-3"></div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-primary searchConfirmDoctor">
                  Pesquisar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>


    <section id="consultas" class="content-section" style="display: none;">
      <h2>Gerenciar Consultas</h2>
      <section class="p-3">
        <div class="row">
          <div class="col-12">
            <button class="btn btn-primary newUser" data-bs-toggle="modal" data-bs-target="#modalCriarConsulta"
              type="button" onclick="limparCamposCriarConsulta()">
              <strong>Criar Consulta</strong><i class="bi bi-clipboard-check"></i>
            </button>

            <button class="btn btn-primary searchUser" data-bs-toggle="modal" data-bs-target="#consultaSearch"
              onclick="limparCamposPesquisaConsulta()">
              <strong>Pesquisar Consulta</strong><i class="bi bi-search"></i>
            </button>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <table class="table table-striped table-hover mt-3 text-center table-bordered">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Data</th>
                  <th>Horário Inicial</th>
                  <th>Nome do Paciente</th>
                  <th>Nome do Médico</th>
                </tr>
              </thead>

              <tbody>
              <tbody id="appointmentTableBody"></tbody>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Modal Criar Consulta -->
      <div class="modal fade" id="modalCriarConsulta">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Criar Consulta</h4>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <form id="form-criar-consulta">
                <div class="mb-3">
                  <label for="consulta-especialidade" class="form-label">Especialidade</label>
                  <select id="consulta-especialidade" class="form-select" required>
                    <option value="">Selecione uma especialidade</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="consulta-data" class="form-label">Data</label>
                  <input type="date" id="consulta-data" class="form-control" required>
                  <div class="valid-feedback">Tudo certo!</div>
                  <div class="invalid-feedback">A data não pode estar em branco.</div>
                </div>

                <div class="mb-3">
                  <label for="criar-consulta-medico" class="form-label">Médico</label>
                  <select id="criar-consulta-medico" class="form-select" required>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="criar-consulta-paciente" class="form-label">Paciente</label>
                  <select id="criar-consulta-paciente" class="form-select" required>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="consulta-horarios-disponiveis" class="form-label">Horários Disponíveis</label>
                  <select id="consulta-horarios-disponiveis" class="form-select" required>
                  </select>
                </div>
              </form>

              <div class="text-center">
                <div id="resultsCreateAppointment" class="mt-3"></div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="submit" form="form-criar-consulta" class="btn btn-primary">Criar Consulta</button>
            </div>
          </div>
        </div>
      </div>


      <!-- Modal de Pesquisa de Consulta -->
      <div class="modal fade" id="consultaSearch" tabindex="-1" aria-labelledby="consultaModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="consultaModalLabel">Pesquisar Consulta</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body">
              <form id="searchFormConsulta">
                <div class="mb-3">
                  <label for="searchEmailPaciente" class="form-label">E-mail do Paciente</label>
                  <input type="email" class="form-control" id="searchEmailPaciente"
                    placeholder="Digite o e-mail do Paciente" required />
                </div>
                <div class="mb-3">
                  <label for="searchDoctorEmail" class="form-label">E-mail do Médico</label>
                  <input type="email" class="form-control" id="searchDoctorEmail"
                    placeholder="Digite o e-mail do Médico" required />
                </div>
                <div class="mb-3">
                  <label for="searchData" class="form-label">Data da Consulta</label>
                  <input type="date" class="form-control" id="searchData" required />
                </div>
                <div class="mb-3">
                  <label for="searchHoraInicio" class="form-label">Hora de Início</label>
                  <input type="time" class="form-control" id="searchHoraInicio" required />
                </div>
              </form>
            </div>
            <div class="text-center">
              <div id="resultsGetAppointment" class="mt-3"></div>
         
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary searchConfirmConsulta">
                Pesquisar
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Delete Confirmation Modal -->
      <div id="deleteModal" class="modal">
        <div class="modal-content">
          <h4>Confirma a exclusão deste item?</h4>
          <button id="confirmDelete" class="btn btn-danger">Sim</button>
          <button id="cancelDelete" class="btn btn-secondary">Não</button>
        </div>
        <div id="resultsDelete"></div>
      </div>
    </section>


  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">


      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        showPatients();
      });


      document.getElementById("form-criar-consulta").addEventListener("submit", async (event) => {
        event.preventDefault();
        await criarConsulta();
      });


    </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      preencherSelectEspecialidades("consulta-especialidade");
      preencherSelectPacientes();
      preencherSelectMedicos();
    });
  </script>
  <script src="inputsValidations.js"></script>
</body>

</html>